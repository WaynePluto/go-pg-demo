### **身份与访问控制 (IACC) 功能开发计划**

**第一阶段：项目结构与数据库初始化**

1.  **智能体创建模块目录**：
    根据 `1.code-design.md` 的规划，创建 `iacc` 模块所需的所有子目录。
    *   `internal/modules/iacc/`
    *   `internal/modules/iacc/user/`
    *   `internal/modules/iacc/role/`
    *   `internal/modules/iacc/auth/`
    *   `internal/modules/iacc/service/`

2.  **终端运行数据库迁移命令**：
    创建用于 `iacc` 功能的数据库迁移文件。
    *   **命令**： `migrate create -ext sql -dir internal/pkgs/migrations iacc_init`

3.  **智能体编写数据库迁移脚本**：
    请你先读取`internal/pkgs/migrations`下面 template 模块的建表语句，参考其中的id、创建/更新时间字段类型以及响应的触发器等SQL语句。
    编辑上一步生成的 `...iacc_init.up.sql` 和 `...iacc_init.down.sql` 文件。
    *   **`up.sql`**：写入创建 `user`, `role`, `user_role` 三张表的 SQL 语句，遵循 `1.code-design.md` 中的表结构设计。
    *   **`down.sql`**：写入删除这三张表的 SQL 语句，用于数据库回滚。

4.  **终端运行数据库迁移**：
    执行迁移，创建数据库表。
    *   **命令**： `migrate -path internal/pkgs/migrations -database "YOUR_DATABASE_CONNECTION_STRING" up`
    *   **注意**：需要将 `YOUR_DATABASE_CONNECTION_STRING` 替换为 config.dev.yaml 文件中实际的数据库连接字符串。

**第二阶段：核心组件与业务模块开发**

5.  **智能体创建权限枚举组件**：
    根据 `1.code-design.md` 的规划，创建用于定义权限常量的包。
    *   创建文件：`internal/pkgs/permissions.go`
    *   在文件中定义权限相关的常量、枚举和描述。

6.  **智能体创建模块空文件**：
    在第一步创建的目录结构中，批量创建各个业务模块所需的 Go 源文件。
    *   `internal/modules/identity/user/type.go`
    *   `internal/modules/identity/user/handler.go`
    *   `internal/modules/identity/user/routes.go`
    *   `internal/modules/identity/user/handler_test.go`
    *   `internal/modules/identity/role/type.go`
    *   `internal/modules/identity/role/handler.go`
    *   `internal/modules/identity/role/routes.go`
    *   `internal/modules/identity/role/handler_test.go`
    *   `internal/modules/identity/auth/type.go`
    *   `internal/modules/identity/auth/handler.go`
    *   `internal/modules/identity/auth/routes.go`
    *   `internal/modules/identity/auth/handler_test.go`
    *   `internal/modules/identity/service/permission_service.go`

7.  **智能体实现 `type.go`**：
    在 `user`, `role`, `auth` 模块的 `type.go` 文件中，定义业务模型、数据库表模型、API 的输入输出参数结构体。

8.  **智能体实现 `permission_service.go`**：
    在 `internal/modules/identity/service/permission_service.go` 文件中，实现计算用户有效权限集的领域服务逻辑。

9.  **智能体实现 `handler.go`**：
    在 `user`, `role`, `auth` 模块的 `handler.go` 文件中，实现所有 API 接口的业务逻辑，包括参数绑定、验证、数据库操作和响应返回。

10. **智能体实现 `routes.go`**：
    在 `user`, `role`, `auth` 模块的 `routes.go` 文件中，注册所有 Gin 路由，并将它们与 `handler` 中的处理函数绑定。

**第三阶段：中间件与依赖注入**

11. **智能体创建授权中间件**：
    根据 `1.code-design.md` 的需求，创建新的授权中间件。
    *   创建文件：`internal/middlewares/authorization.go`
    *   在文件中实现基于角色和权限的访问控制逻辑。

12. **智能体注册依赖**：
    将新创建的 `handler` 构造函数注册到依赖注入配置中。
    *   编辑文件：wire.go
    *   在 `wire.go` 中添加 `user`、`role`、`auth` 的 `handler` 构造函数。

13. **终端更新依赖注入**：
    运行 `wire` 命令生成依赖注入代码。
    *   **命令**： `wire ./internal/app`

14. **智能体注册路由**：
    将 `identity` 模块下的所有路由注册到主路由中。
    *   编辑文件：router.go
    *   调用 `user`, `role`, `auth` 模块的路由注册函数。

**第四阶段：测试与验证**

15. **智能体编写单元测试**：
    在 `user`, `role`, `auth` 模块的 `handler_test.go` 文件中，为每个 API 编写单元测试，遵循 `Arrange-Act-Assert` (AAA) 模式，覆盖正常和异常场景。

16. **终端运行单元测试**：
    执行测试以验证代码的正确性。
    *   **命令**： `go test modules.`

