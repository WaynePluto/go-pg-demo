# **领域模型设计**

*   **领域模型摘要**：
    *   **核心子域**：**身份与访问控制**
    *   **限界上下文**：`Identity & Access Control Context`

*   **聚合详情**:

    *   **聚合根 1**： `User`
        *   **值对象**： `UserId`, `Username`, `Phone`, `Password` (密码不需要后端处理，前端直接传md5处理后的密文),`Profile` (可能包含 `nickname`, `department` 等扩展信息，但是不确定)
        *   **领域行为**：
            *   `create(username, phone, profileData, ...)`
            *   `changePassword(newPassword)`
            *   `updateProfile(profileData)`
            *   `assignRole(roleId)`
            *   `removeRole(roleId)`
        *   **业务规则**：
            *   用户名和手机号在系统内必须唯一。
        *   **仓储接口**： `IUserRepository`

    *   **聚合根 2**： `Role`
        *   **值对象**： `RoleId`, `PermissionKey`
        *   **主要属性**： `name`, `description`, `permissions` (Set<PermissionKey>)
        *   **领域行为**：
            *   `create(name, description)`
            *   `rename(newName)`
            *   `assignPermission(permissionKey)`
            *   `revokePermission(permissionKey)`
        *   **业务规则**：
            *   角色名在系统内必须唯一。
            *   权限集不能包含重复的权限键。
        *   **仓储接口**： `IRoleRepository`

*   **领域服务**：
    *   `PermissionCalculationService`
        *   **职责**：计算用户的最终有效权限集。
        *   **方法**： `CalculateEffectivePermissionsForUser(User user) : Set<PermissionKey>`
        *   **工作逻辑**： 加载用户所有 `assignedRoleIds` 对应的 `Role` 聚合，将其 `permissions` 集合合并、去重后返回。

*   **权限常量定义**：
    *   使用 **枚举** 或 **常量类** 来定义所有可用的 `PermissionKey`，主要包含权限编码和权限描述。

*   **初始数据种子（预制数据）**：
    *   系统初始化时，应通过数据库种子脚本或应用启动逻辑创建以下数据：
        1.  **权限集合**：预定义所有可用的权限枚举。
        2.  **基础角色**：
            *   **超级管理员 (SuperAdmin)**：拥有所有权限。
            *   **普通用户 (BasicUser)**：拥有最基本的、非管理性的只读权限。
        3.  **默认管理员用户**：一个初始的超级管理员账号，用于首次登录配置系统。

