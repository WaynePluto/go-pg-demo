# **领域模型设计**

*   **领域模型摘要**：
    *   **核心子域**：**身份与访问控制**
    *   **限界上下文**：`Identity & Access Control Context`

*   **聚合详情**:

    *   **聚合根 1**： `User`
        *   **实体**： `Profile` (内部实体，包含 `fullName`, `department` 等扩展信息)
        *   **值对象**： `UserId`, `Phone`, `Password` (密码不需要后端处理，前端直接传md5处理后的密文)
        *   **主要属性**： `username`, `status` (Active/Inactive), `assignedRoleIds` (List<RoleId>)
        *   **领域行为**：
            *   `create(username, phone, profileData, ...)`
            *   `changePassword(newPassword)`
            *   `updateProfile(profileData)`
            *   `assignRole(roleId)`
            *   `removeRole(roleId)`
            *   `disable()`
            *   `enable()`
        *   **业务规则**：
            *   用户名和手机号在系统内必须唯一。
            *   用户状态为“禁用”时，无法通过认证。
        *   **仓储接口**： `IUserRepository`

    *   **聚合根 2**： `Role`
        *   **值对象**： `RoleId`, `PermissionKey`
        *   **主要属性**： `name`, `description`, `permissions` (Set<PermissionKey>)
        *   **领域行为**：
            *   `create(name, description)`
            *   `rename(newName)`
            *   `assignPermission(permissionKey)`
            *   `revokePermission(permissionKey)`
        *   **业务规则**：
            *   角色名在系统内必须唯一。
            *   权限集不能包含重复的权限键。
        *   **仓储接口**： `IRoleRepository`

*   **领域服务**：
    *   `PermissionCalculationService`
        *   **职责**：计算用户的最终有效权限集。
        *   **方法**： `CalculateEffectivePermissionsForUser(User user) : Set<PermissionKey>`
        *   **工作逻辑**： 加载用户所有 `assignedRoleIds` 对应的 `Role` 聚合，将其 `permissions` 集合合并、去重后返回。

*   **领域事件**：
    *   `UserRegisteredEvent` (载荷: UserId)
    *   `UserRoleChangedEvent` (载荷: UserId)
    *   `RolePermissionsChangedEvent` (载荷: RoleId)

*   **权限常量定义**：
    *   使用 **枚举** 或 **常量类** 来定义所有可用的 `PermissionKey`。
    *   **优点**：
        1.  **类型安全**：编译时检查，避免拼写错误。
        2.  **易于发现**：IDE有自动补全功能，开发者无需记忆字符串。
        3.  **便于重构**：重命名权限时，可以安全地全局替换。

*   **初始数据种子（预制数据）**：
    *   系统初始化时，应通过数据库种子脚本或应用启动逻辑创建以下数据：
        1.  **权限集合**：预定义所有可用的权限枚举。
        2.  **基础角色**：
            *   **超级管理员 (SuperAdmin)**：拥有所有权限。
            *   **普通用户 (BasicUser)**：拥有最基本的、非管理性的权限。
        3.  **默认管理员用户**：一个初始的超级管理员账号，用于首次登录配置系统。

